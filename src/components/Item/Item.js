import React, { useState, useEffect } from 'react'
import swal from 'sweetalert';
import { Link } from 'react-router-dom'
import {ItemCount} from '../ItemCount/ItemCount'
import './item.css'

export const Item = ({item}) => {

    const [articuloAgregado, setArticuloAgregado] = useState(0);
    const [validar, setValidar] = useState(false);

    const onAdd = ((CantidadArticulos) => {
        if(CantidadArticulos > item.stock){
            swal({
                title: "Sin stock",
                text: `Tenemos ${item.stock} artÃ­culos disponibles ðŸ˜”`,
                icon: "error",
            });
        } else if (CantidadArticulos < item.minQty) {
            swal({
                title: "Error",
                text: `Cantidad mÃ­nima: ${item.minQty} artÃ­culo/s ðŸ¤”`,
                icon: "error",
            });
        } else if ((CantidadArticulos + articuloAgregado) <= item.stock){
            swal({
                title: "Elementos agregados a tu carrito",
                text: `Agregaste ${CantidadArticulos} artÃ­culo/s ðŸ˜€`,
                icon: "success",
            }).then(() => {
                setArticuloAgregado(CantidadArticulos + articuloAgregado);
                setValidar(true);
                
            })
        } else {
            swal({
                title: "Sin stock",
                text: `Tenemos ${item.stock} artÃ­culos disponibles y aÃ±adiste ${articuloAgregado} a tu carrito.`,
                icon: "error",
            });
        }
    })

    useEffect(() => {
        if(articuloAgregado){
        swal({
            title: "ArtÃ­culos en carrito",
            text: `Tenes ${articuloAgregado} artÃ­culo/s en tu carrito ðŸ˜€`,
            icon: "warning",
        })
    }
    },[articuloAgregado]);

    return (
        <>
            <div className="producto">
                <Link to={`/item/${item.id}`}>
                    <img src={item.pictureUrl} className="destacada" alt="producto" />
                </Link>
                    <div className="descripcion-producto">
                        <Link to={`/item/${item.id}`}>
                            <h4>{item.title}</h4>
                        </Link>
                        <p>{item.description}</p>
                        <span>${item.price}</span>
                        <ItemCount stock={item.stock} initial="1" agregarCarrito={onAdd} />
                        { validar && 
                        <Link to={`/cart/`}><div className="terminar-compra">Terminar mi compra</div></Link>}
                    </div>
                
            </div>
        </>
    )
}